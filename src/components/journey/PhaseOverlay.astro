---
// Life phase overlay configuration
interface PhaseConfig {
  name: string;
  startYear: number;
  endYear: number;
  color: string;
  description: string;
  opacity: number;
}

const phases: PhaseConfig[] = [
  {
    name: 'Childhood',
    startYear: 0,
    endYear: 11,
    color: 'rgba(59, 130, 246, 0.15)', // Blue nebula
    description: 'Foundation years of discovery and wonder',
    opacity: 0.15
  },
  {
    name: 'Adolescence',
    startYear: 12,
    endYear: 18,
    color: 'rgba(249, 115, 22, 0.15)', // Orange nebula
    description: 'Transformation and identity formation',
    opacity: 0.15
  },
  {
    name: 'Young Adulthood',
    startYear: 19,
    endYear: 29,
    color: 'rgba(147, 51, 234, 0.15)', // Purple nebula
    description: 'Exploration and early independence',
    opacity: 0.15
  },
  {
    name: 'Early Adulthood',
    startYear: 30,
    endYear: 39,
    color: 'rgba(37, 99, 235, 0.15)', // Deep blue nebula
    description: 'Establishment and career building',
    opacity: 0.15
  },
  {
    name: 'Middle Adulthood',
    startYear: 40,
    endYear: 64,
    color: 'rgba(245, 158, 11, 0.15)', // Amber nebula
    description: 'Peak productivity and leadership',
    opacity: 0.15
  },
  {
    name: 'Late Adulthood',
    startYear: 65,
    endYear: 79,
    color: 'rgba(156, 163, 175, 0.15)', // Silver nebula
    description: 'Wisdom sharing and reflection',
    opacity: 0.15
  },
  {
    name: 'Advanced Age',
    startYear: 80,
    endYear: 100,
    color: 'rgba(203, 213, 225, 0.15)', // Pearl nebula
    description: 'Legacy and transcendence',
    opacity: 0.15
  }
];
---

<div class="phase-overlay-container">
  <!-- Phase Overlays -->
  <div class="phase-overlays">
    {phases.map((phase) => (
      <div
        class="phase-overlay"
        data-phase={phase.name.toLowerCase().replace(' ', '-')}
        style={`
          --phase-color: ${phase.color};
          --phase-start: ${phase.startYear + 1};
          --phase-end: ${phase.endYear + 1};
          --phase-height: ${phase.endYear - phase.startYear + 1};
        `}
      >
        <div class="phase-glow"></div>
      </div>
    ))}
  </div>

  <!-- Phase Legend -->
  <div class="phase-legend">
    <button class="legend-toggle" type="button" aria-label="Toggle phase legend">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span>Life Phases</span>
    </button>
    
    <div class="legend-content">
      <h3 class="legend-title">Cosmic Life Phases</h3>
      <div class="legend-items">
        {phases.map((phase) => (
          <div class="legend-item" data-phase={phase.name.toLowerCase().replace(' ', '-')}>
            <div 
              class="legend-color" 
              style={`background: ${phase.color}; box-shadow: 0 0 8px ${phase.color};`}
            ></div>
            <div class="legend-info">
              <span class="legend-name">{phase.name}</span>
              <span class="legend-years">Ages {phase.startYear}-{phase.endYear}</span>
              <span class="legend-description">{phase.description}</span>
            </div>
          </div>
        ))}
      </div>
      
      <div class="legend-controls">
        <button class="legend-btn toggle-all" type="button">
          <span>Toggle All Phases</span>
        </button>
        <button class="legend-btn reset-view" type="button">
          <span>Reset View</span>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  .phase-overlay-container {
    position: relative;
    pointer-events: none;
  }

  .phase-overlays {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1;
  }

  .phase-overlay {
    position: absolute;
    left: 0;
    right: 0;
    background: var(--phase-color);
    border-radius: 8px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    
    /* Calculate position based on year */
    top: calc((var(--phase-start) - 1) * 16px);
    height: calc(var(--phase-height) * 16px);
    
    /* Cosmic glow effect */
    box-shadow: 
      inset 0 0 20px var(--phase-color),
      0 0 10px var(--phase-color);
  }

  .phase-glow {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(
      ellipse at center,
      var(--phase-color) 0%,
      transparent 70%
    );
    opacity: 0.3;
    animation: cosmic-pulse 8s ease-in-out infinite;
  }

  .phase-legend {
    position: fixed;
    top: 50%;
    right: 2rem;
    transform: translateY(-50%);
    z-index: 10;
    pointer-events: auto;
  }

  .legend-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: rgba(10, 10, 20, 0.95);
    /* Safari-compatible: backdrop-filter removed */
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    color: rgba(255, 255, 255, 0.8);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.875rem;
    box-shadow: 
      0 10px 30px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .legend-toggle:hover {
    background: rgba(20, 20, 40, 0.95);
    border-color: rgba(140, 170, 238, 0.4);
    color: #8CAAEE;
    box-shadow: 
      0 15px 35px rgba(0, 0, 0, 0.4),
      0 0 20px rgba(140, 170, 238, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
  }

  .legend-content {
    position: absolute;
    right: 0;
    top: 100%;
    margin-top: 0.5rem;
    width: 320px;
    max-height: 500px;
    background: rgba(10, 10, 20, 0.98);
    /* Safari-compatible: backdrop-filter removed */
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 
      0 20px 40px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    
    /* Hidden by default */
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .legend-toggle:hover + .legend-content,
  .legend-content:hover {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .legend-title {
    font-size: 1.125rem;
    font-weight: bold;
    color: var(--text-primary);
    margin-bottom: 1rem;
    text-align: center;
    background: linear-gradient(135deg, #8CAAEE 0%, #F5BDE6 50%, #A6D189 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .legend-items {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 1rem;
    max-height: 300px;
    overflow-y: auto;
  }

  .legend-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.5rem;
    border-radius: 8px;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .legend-item:hover {
    background: rgba(255, 255, 255, 0.05);
    transform: translateX(4px);
  }

  .legend-color {
    width: 16px;
    height: 16px;
    border-radius: 4px;
    flex-shrink: 0;
    margin-top: 2px;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .legend-info {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    flex: 1;
  }

  .legend-name {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .legend-years {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.6);
    font-weight: 500;
  }

  .legend-description {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    line-height: 1.3;
  }

  .legend-controls {
    display: flex;
    gap: 0.5rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .legend-btn {
    flex: 1;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .legend-btn:hover {
    background: rgba(140, 170, 238, 0.2);
    border-color: rgba(140, 170, 238, 0.4);
    color: #8CAAEE;
    box-shadow: 0 0 8px rgba(140, 170, 238, 0.3);
  }

  /* Phase-specific hover effects */
  .legend-item[data-phase="childhood"]:hover .legend-color {
    box-shadow: 0 0 12px rgba(59, 130, 246, 0.6);
  }

  .legend-item[data-phase="adolescence"]:hover .legend-color {
    box-shadow: 0 0 12px rgba(249, 115, 22, 0.6);
  }

  .legend-item[data-phase="young-adulthood"]:hover .legend-color {
    box-shadow: 0 0 12px rgba(147, 51, 234, 0.6);
  }

  .legend-item[data-phase="early-adulthood"]:hover .legend-color {
    box-shadow: 0 0 12px rgba(37, 99, 235, 0.6);
  }

  .legend-item[data-phase="middle-adulthood"]:hover .legend-color {
    box-shadow: 0 0 12px rgba(245, 158, 11, 0.6);
  }

  .legend-item[data-phase="late-adulthood"]:hover .legend-color {
    box-shadow: 0 0 12px rgba(156, 163, 175, 0.6);
  }

  .legend-item[data-phase="advanced-age"]:hover .legend-color {
    box-shadow: 0 0 12px rgba(203, 213, 225, 0.6);
  }

  /* Cosmic animations */
  @keyframes cosmic-pulse {
    0%, 100% {
      opacity: 0.2;
      transform: scale(1);
    }
    50% {
      opacity: 0.4;
      transform: scale(1.02);
    }
  }

  /* Responsive design */
  @media (max-width: 1024px) {
    .phase-legend {
      right: 1rem;
    }
    
    .legend-content {
      width: 280px;
    }
  }

  @media (max-width: 768px) {
    .phase-legend {
      position: static;
      transform: none;
      margin-bottom: 1rem;
    }
    
    .legend-content {
      position: static;
      width: 100%;
      margin-top: 0.5rem;
      opacity: 1;
      visibility: visible;
      transform: none;
      max-height: 200px;
    }
    
    .legend-toggle {
      width: 100%;
      justify-content: center;
    }
    
    .phase-overlay {
      top: calc((var(--phase-start) - 1) * 12px);
      height: calc(var(--phase-height) * 12px);
    }
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    .phase-glow {
      animation: none;
    }
    
    .phase-overlay,
    .legend-toggle,
    .legend-content,
    .legend-item,
    .legend-btn {
      transition: none;
    }
  }

  /* Focus styles */
  .legend-toggle:focus,
  .legend-btn:focus,
  .legend-item:focus {
    outline: 2px solid rgba(140, 170, 238, 0.5);
    outline-offset: 2px;
  }

  /* Custom scrollbar for legend items */
  .legend-items::-webkit-scrollbar {
    width: 4px;
  }

  .legend-items::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 2px;
  }

  .legend-items::-webkit-scrollbar-thumb {
    background: rgba(140, 170, 238, 0.3);
    border-radius: 2px;
  }

  .legend-items::-webkit-scrollbar-thumb:hover {
    background: rgba(140, 170, 238, 0.5);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const phaseToggle = document.getElementById('phase-toggle');
    const phaseOverlays = document.getElementById('phase-overlays');
    const toggleText = phaseToggle?.querySelector('.toggle-text');
    
    let phasesVisible = true;
    
    phaseToggle?.addEventListener('click', () => {
      phasesVisible = !phasesVisible;
      
      if (phasesVisible) {
        phaseOverlays?.classList.remove('hidden');
        if (toggleText) toggleText.textContent = 'Hide Phases';
      } else {
        phaseOverlays?.classList.add('hidden');
        if (toggleText) toggleText.textContent = 'Show Phases';
      }
    });
    
    // Add hover effects for legend items
    const legendItems = document.querySelectorAll('.legend-item');
    legendItems.forEach(item => {
      const phaseName = item.classList[1]?.replace('legend-', '');
      const phaseOverlay = document.querySelector(`.phase-${phaseName}`);
      
      item.addEventListener('mouseenter', () => {
        (phaseOverlay as HTMLElement)?.style.setProperty('opacity', '0.3');
      });
      
      item.addEventListener('mouseleave', () => {
        (phaseOverlay as HTMLElement)?.style.removeProperty('opacity');
      });
    });
  });
</script> 